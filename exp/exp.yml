err_text_exp:
  command: /err_text_exp
  type:
  - RUN_COMMAND
  runcmd:
  - $Script$%if%$arg1==expNotEnough
  - $text$&c 经验不够哟～ (如果您认为有误, 联络管理员以解决该问题)
  - $Script$%if%$arg1==invalid_params
  - $text$&c 参数无效哟～ 检查一下您的输入吧!
  - $Script$%if%$arg1==isSameUser
  - $text$&c 不能给自己转载哟～
  - $Script$%if%$arg1==invalid_action
  - $text$&c 哎呀, 操作无效哟～ 联络管理员以解决该问题
  - $Script$%if%$arg1==invalid_user
  - $text$&c 哎呀, 出小差啦. 用户名无效哟～ 联络管理员以解决该问题
  - $Script$%if%$arg1==alreadyUsed
  - $text$&c 只能兑换一次哦! 您已经兑换过啦～
  - $Script$%if%$arg1==todayAlreadyUsed
  - $text$&c 今天已经兑换过了哦，明天再来吧～
  - $Script$%if%$arg1==totalLimit
  - $text$&c 哎呀,达到兑换上限了喔～
  - $Script$%else%
  - $text$&c 未知错误欸! 联络管理员以解决该问题
  permission-required: false

run_exp_msg:
  command: /run_exp_msg
  execute_mode: FROM_ANOTHER_COMMAND  
  type:
  - RUN_COMMAND
  runcmd:
  - $Script$%if%$arg1==overAndOut
  - $text$&7 您存入了&b $arg2 &7xp , 现在您的账户有&d $arg3 &7exp!
  - $Script$%if%$arg1==success
  - $RUN_CONSOLE$essentials:exp give $player $arg2
  - $text$&7 取出成功! 本次操作经验&a $arg2 &7, 您还有&d $arg3 &7经验
  - $Script$%if%$arg1==successPay
  - $text$&7 转账成功! 您向&d $arg2 &7转账 &6$arg3 &7经验 (实际到账$arg5 xp), 您还有&d $arg4 &7经验
  - "$RUN_CONSOLE$essentials:mail send $arg2 &7玩家&d $player &7转账给您&e $arg3 &7xp (实际到账&6 $arg5 &7xp) 。可以透过&a/xp&7 命令存取"
  - $Script$%if%$arg1==info
  - $text$&7 系统账户中有&d $arg2 &7xp
  - $text$&7 您身上有&d $exp &7xp

  - $Script$%else%
  - $text$&c 未知错误欸! 联络管理员以解决该问题
  permission-required: false
  
# $arg1 : 动作, save raw info ... 存储，取出，查询..
# $arg2 : 数量
# $arg3 : 對象 (适用于pay)
go_xp:
  command: /go_xp
  execute_mode: FROM_ANOTHER_COMMAND
  type: CALL_URL
  url: http://neko.moe/exp.php?user=$player&action=$arg1&nums=$arg2&object=$arg3
  get_output : true
  show_output_ingame : false
  get_run_command: $output 
  permission-required: false 

# 兌換物品，由商店點擊後調用
# $arg1 : 物品名稱
go_xp_exchange:
  command: /go_xp_exchange
  execute_mode: FROM_ANOTHER_COMMAND 
  type: CALL_URL
  url: http://neko.moe/exp.php?user=$player&action=exchange&item=$arg1
  get_output : true
  show_output_ingame : false
  get_run_command: $output 
  permission-required: false 

# 存儲數值以供商店使用
get_xp_for_save:
  command: /get_xp_for_save
  execute_mode: FROM_ANOTHER_COMMAND 
  type: CALL_URL
  url: http://neko.moe/exp.php?user=$player&action=info&outraw=yes
  get_output : true
  save_output_as : system_account_exp
  permission-required: false 

# 存儲限制次數以供商店顯示
get_xp_data_limit_for_apple_save:
  command: /get_xp_data_limit_for_apple_save
  execute_mode: FROM_ANOTHER_COMMAND 
  type: CALL_URL
  url: http://neko.moe/exp.php?user=$player&action=info&item=enchantedGoldenApple3&outraw=yes
  get_output : true
  save_output_as : exp_limit_for_apple
  permission-required: false 

get_xp_data_limit_for_CloudspringAzureBlade_save:
  command: /get_xp_data_limit_for_CloudspringAzureBlade_save
  execute_mode: FROM_ANOTHER_COMMAND 
  type: CALL_URL
  url: http://neko.moe/exp.php?user=$player&action=info&item=CloudspringAzureBlade&outraw=yes
  get_output : true
  save_output_as : exp_limit_for_CloudspringAzureBlade
  permission-required: false 

# 執行兌換並刷新數據
do_exp_exchange:
  command: /do_exp_exchange
  type:
  - RUN_COMMAND
  runcmd:
  - /go_xp_exchange $arg1
  - $delay$/refresh_exp_value
  delaytimer: 5
  delaytimer_format: TICKS
  permission-required: false
  execute_mode: FROM_ANOTHER_COMMAND

# 刷新經驗數據
refresh_exp_value:
  command: /refresh_exp_value
  type:
  - RUN_COMMAND
  runcmd:
  - /get_xp_for_save
  - /get_xp_data_limit_for_CloudspringAzureBlade_save
  - /get_xp_data_limit_for_apple_save
  permission-required: false
  execute_mode: FROM_ANOTHER_COMMAND

xp:
 command: /xp
 type:
 - RUN_COMMAND
 runcmd:
 - $Script$%if%$arg1==pay
 - /go_xp pay $arg3 $arg2 
 - $Script$%elseif%$arg1==save
 - /go_xp save $exp
 - "$RUN_CONSOLE$essentials:xp take $player $exp"
 - $Script$%elseif%$arg1==raw
 - /go_xp raw $arg2
 - $Script$%elseif%$arg1==info
 - /go_xp info
 - $Script$%elseif%$arg1==shop
 - /xp_shop # 直接打開商店
 - /refresh_exp_value # 同時刷新數據
 - $Script$%else%
 - $text$ &e&l经验系统
 - $rawtext$ &7/xp &bpay &7(目标) (数量) 转账经验给指定玩家;&7/xp pay转账给玩家;/xp pay (玩家) (数量)
 - $rawtext$ &7/xp &6raw &7(数量) 从系统取出经验;&7/xp raw从系统取出经验;/xp raw (取出数量)
 - $rawtext$ &7/xp &dsave &7将所有经验存入系统;&7存入所有经验;/xp save
 - $rawtext$ &7/xp &2info &7查询经验;&7查询经验;/xp info
 - $rawtext$ &7/xp &eshop &7经验商店;&7打开经验商店;/xp shop
 register: true
 tab_completer: 
  1:
  - save
  - info
  - raw
  - pay
  - shop

  2: 
  - $player_list<pos_1=pay>
  - 转账给指定玩家<pos_1=pay>
  - 转错就没啦!<pos_1=pay> 
  - 1-999..<pos_1=raw> 
  - 取出多少经验呢?<pos_1=raw> 
  3:
  - 1-999..<pos_1=pay>
  - 要转账多少哟?<pos_1=pay>
 permission-required: true
 permission-node: neko.default.1 

xp_shop: 
  command: /xp_shop
  type: ICON_MENU
  iconmenu_title: "&e经验商店"
  iconmenu_size: 36
  icinmenu_type: CHEST
  iconmenu_mode: DYNAMIC
  permission-required: false
  iconmenu_itemflags:
  - HIDE_ATTRIBUTES
  - HIDE_DESTROYS
  - HIDE_ENCHANTS
  - HIDE_PLACED_ON
  - HIDE_POTION_EFFECTS
  - HIDE_UNBREAKABLE
  iconmenu_commands:
  # 頂部資訊
  - "0:PLAYER_HEAD%$player:0:%stayopen%:&a您的经验:&7账户经验 &e$PlayerData%system_account_exp%;&7现有经验 &e$exp"
  
  # 神器兌換 - 修正兌換次數顯示格式
  - "11:DIAMOND_SWORD;DAMAGE_ALL;1:0:%stayopen%:&b碧波云泉剑:劍光映碧波 出鞘起雲泉;&9锋利X;&3击退5;&7耐久3;;&7限兑 &e$PlayerData%exp_limit_for_CloudspringAzureBlade%&7/1次;&7需要 &d300,000 &7经验"
  - "20:ENDER_EYE:0:%stayopen%/do_exp_exchange CloudspringAzureBlade:&a兑换碧波云泉剑:&7消耗 &d300,000 &7经验;&7&l点击兑换"
  
  # 金幣兌換
  - "13:EMERALD:0:%stayopen%:&e金币兑换:&7兑换 &a100 &7金币;&7限制 &e每日一次;&7需要 &d10,000 &7经验"
  - "22:ENDER_EYE:0:%stayopen%/do_exp_exchange bal100:&a兑换金币:&7消耗 &d10,000 &7经验;&7获得 &6100 &7金币;&7&l点击兑换"
  
  # 金蘋果兌換 - 修正兌換次數顯示格式
  - "15:ENCHANTED_GOLDEN_APPLE:0:%stayopen%:&6附魔金苹果:&7兑换 &a3个 &6附魔金苹果;&7已兑换 &e$PlayerData%exp_limit_for_apple% &7/ 100次;&7需要 &d5,000 &7经验"
  - "24:ENDER_EYE:0:%stayopen%/do_exp_exchange enchantedGoldenApple3:&a兑换附魔金苹果:&7消耗 &d5,000 &7经验;&7获得 &63个 &7附魔金苹果;&7&l点击兑换"
  
  # 經驗操作說明
  - "18:BOOK:0:%stayopen%:&a经验操作说明:&7● &e/xp save &7- 存入经验;&7● &e/xp raw [数量] &7- 取出经验;&7● &e/xp pay [玩家] [数量] &7- 转账经验"
  
  # 底部按鈕
  - "27:ARROW:0:%stayopen%/neko_menu:&a返回主页:&7返回主菜单"
  # - "49:REDSTONE:0:%stayopen%/refresh_exp_value:&a刷新数据:&7刷新经验数据"
  - "35:BARRIER:0:%close%:&c关闭:&7关闭菜单"

exp_exchange:
  command: /exp_exchange
  execute_mode: FROM_ANOTHER_COMMAND 
  type:
  - RUN_COMMAND
  runcmd:
  - $Script$%if%$arg1==CloudspringAzureBlade
  - $text$&7 兑换神装 碧波云泉剑成功! 消耗$arg2 xp 剩余$arg3 xp
  - /artifact_rewards CloudspringAzureBlade
  # - $RUN_CONSOLE$minecraft:give $player minecraft:diamond_sword{display:{Name:'{"color":"#71CCFA","text":"碧波云泉剑"}',Lore:['"劍光映碧波 出鞘起雲泉"']},Enchantments:[{id:"minecraft:sharpness",lvl:10},{id:"minecraft:knockback",lvl:5},{id:"minecraft:unbreaking",lvl:3}]} 1
  - $RUN_CONSOLE$broadcast 恭喜玩家 &e $player &a 获得 &b 碧波云泉剑 &a! 
  - $Script$%if%$arg1==bal100
  - $text$&7 兑换100金币成功! 消耗$arg2 xp 剩余$arg3 xp
  - $RUN_CONSOLE$essentials:eco give $player 100
  - $Script$%if%$arg1==enchantedGoldenApple3
  - $text$&7 兑换成功! 获得附魔金苹果3个 消耗$arg2 xp 剩余$arg3 xp
  - $RUN_CONSOLE$minecraft:give $player minecraft:enchanted_golden_apple 3
  - $Script$%else%
  - $text$&c 无效的发放id! 这应该是个错误?
  permission-required: false